


Этот проект предназначен для управления ПК через MQTT-брокер и отправки статуса активного окна. С помощью этой программы можно выполнять удаленные команды, такие как выключение компьютера, перевод в спящий режим и пробуждение, а также отслеживать, какое окно активно в данный момент.

---

#### Основные функции:

1. **Удаленное управление ПК через MQTT:**
   - **Выключение компьютера** (`shutdown_pc()`).
   - **Переход в спящий режим** (`sleep_pc()`).
   - **Обработка пользовательских команд**, таких как `shutdown`, `sleep`, `wake_up`, и пользовательская логика `OFF()`.

2. **Мониторинг активного окна:**
   - Отправка названия активного окна через MQTT в заданный топик.
   - Обработка окон с учетом пользовательских условий (например, выделение окон с YouTube или Яндекс).

3. **Интеграция с MQTT:**
   - Подключение к MQTT-брокеру с использованием учетных данных.
   - Подписка на топики для получения команд.
   - Публикация статуса активного окна в отдельный топик.

4. **Обработка активного окна:**
   - Использует библиотеку `pygetwindow` для получения текущего активного окна.
   - Обработка названия активного окна и выполнение действий в зависимости от содержания.

---

#### Настройка и запуск:

1. Установите необходимые библиотеки (см. файл `requirements.txt` ниже).
2. Настройте параметры подключения в разделе конфигурации:
   - **`BROKER`**: IP-адрес вашего MQTT-брокера.
   - **`PORT`**: Порт для подключения.
   - **`USERNAME` и `PASSWORD`**: Учетные данные.
3. Запустите скрипт, выполнив команду:
   ```bash
   python main.py
   ```

---

#### Структура MQTT:

- **Команды**:
  - `home/pc/commands` — принимает команды, такие как `shutdown`, `sleep`, `wake_up`, `OFF`.
- **Статус**:
  - `home/pc/status/sensor_pc_active_window` — отправляет название текущего активного окна.

---



Установите их командой:

```bash
pip install -r requirements.txt
```

---

#### Примечания:

 **Платформа**: Код разработан для Windows, так как использует команды `os.system` для управления питанием и библиотеку `pygetwindow`.



# Конфигурация управления приложением через JSON

Этот файл описывает, как настроить `config.json` для управления приложениями и действиями.

## Структура `config.json`

```json
{
    "mqtt": {
        "broker": "Адрес MQTT-брокера (например, 192.168.1.109)",
        "port": "Порт MQTT-брокера (например, 1883)",
        "client_id": "Идентификатор клиента MQTT",
        "username": "Имя пользователя для MQTT",
        "password": "Пароль для MQTT"
    },
    "commands": {
        "shutdown": "Системная команда для выключения компьютера",
        "sleep": "Системная команда для перехода в спящий режим"
    },
    "window_rules": {
        "Название окна или приложения": [
            {
                "action": "Тип действия (press/type)",
                "key": "Клавиша или текст для действия",
                "duration": "Длительность нажатия (в секундах, только для press)"
            }
        ],
        "Простая замена названия окна": "Новое название окна"
    },
    "topics": {
        "commands": "MQTT-топик для получения команд",
        "active_window": "MQTT-топик для публикации активного окна"
    }
}
```

## Настройка

### 1. MQTT
- **broker**: Укажите IP-адрес или доменное имя MQTT-брокера.
- **port**: Укажите порт подключения (обычно `1883`).
- **client_id**: Придумайте уникальный идентификатор клиента.
- **username**: Укажите логин пользователя MQTT.
- **password**: Укажите пароль пользователя MQTT.

### 2. Команды
Добавьте команды для управления компьютером.  
Пример:
```json
"commands": {
    "shutdown": "shutdown /s /t 1",
    "sleep": "shutdown /h"
}
```

### 3. Правила для окон
#### **Добавление действия для окна**
Используйте массив объектов для описания действий:  
Пример:
```json
"YouTube": [
    {"action": "press", "key": "space", "duration": 0.1},
    {"action": "press", "key": "F1", "duration": 1}
]
```

#### **Добавление замены названия окна**
Если нужно заменить название окна:  
Пример:
```json
"Яндекс": "Яндекс"
```

#### **Полный пример**
```json
"window_rules": {
    "YouTube": [
        {"action": "press", "key": "space", "duration": 0.1},
        {"action": "press", "key": "F1", "duration": 1}
    ],
    "Spotify": [
        {"action": "press", "key": "play/pause", "duration": 0.1},
        {"action": "press", "key": "nexttrack", "duration": 0.1}
    ],
    "Яндекс": "Яндекс",
    "Google Chrome": "Google Chrome"
}
```

### 4. Топики MQTT
- **commands**: Укажите топик для получения команд.
- **active_window**: Укажите топик для отправки названия активного окна.

## Пример готового файла

```json
{
    "mqtt": {
        "broker": "192.168.1.109",
        "port": 1883,
        "client_id": "PC_Client",
        "username": "user",
        "password": "passwd"
    },
    "commands": {
        "shutdown": "shutdown /s /t 1",
        "sleep": "shutdown /h"
    },
    "window_rules": {
        "YouTube": [
            {"action": "press", "key": "space", "duration": 0.1},
            {"action": "press", "key": "F1", "duration": 1}
        ],
        "Spotify": [
            {"action": "press", "key": "play/pause", "duration": 0.1},
            {"action": "press", "key": "nexttrack", "duration": 0.1}
        ],
        "Яндекс": "Яндекс",
        "Google Chrome": "Google Chrome"
    },
    "topics": {
        "commands": "home/pc/commands",
        "active_window": "home/pc/status/sensor_pc_active_window"
    }
}
```
